<DOCTYPE HTML>
<html>
<head>
	<title>
		Firewall Border Control
	</title>
	<meta charset="utf-8">
</head>

<body>
	Your IP: <span id="YourIP"></span> <br>
	Source IP: <span id="SourceIP"></span> <br>
	Destination IP: <span id="DestinationIP"></span>  <br>
	Source Port: <span id="SourcePort"></span> <br>
	Destination Port: <span id="DestinationPort"></span> <br>
	
	
	Rules: Deny packets not meant for us  <br>
	<span id="Rule2"></span> <span id ="AllowFrom"></span> <br>
	<button type="button" onclick="check('allow')" id="accept">Accept</button> 
	<button type="button" onclick="check('deny')" id="deny">Deny</button> <br>
	Score: <span id ="Score"> </span> <br>
	Lives: <span id ="Lives"> </span> <br>
	<span id="Message"> </span>
	
</body>


<script>
	var ipList = []
	var portList = [23, 80, 443, 20, 21]
	
	function chooseIP(score){
		if (document.getElementById("YourIP").innerHTML.length == 0) {
			document.getElementById("YourIP").innerHTML = get_random(ipList);
		}
		document.getElementById('SourceIP').innerHTML = get_random(ipList);
		document.getElementById('DestinationIP').innerHTML = get_random(ipList);
		if (score == 9 && document.getElementById('AllowFrom').innerHTML.length == 0) {
			document.getElementById("Rule2").innerHTML = "Allow packets from the IP ";
			document.getElementById("AllowFrom").innerHTML = get_random(ipList);
		}
	}
	
	function choosePorts(score) {
		document.getElementById("SourcePort").innerHTML = get_random(portList);
		document.getElementById("DestinationPort").innerHTML = get_random(portList);
	}
	
	function randomIP() {
		return (Math.floor(Math.random() * 255) + 1)+"."+(Math.floor(Math.random() * 255))+"."+(Math.floor(Math.random() * 255))+"."+(Math.floor(Math.random() * 255));
	}
	
	function get_random (list) {
		return list[Math.floor((Math.random()*list.length))];
	}
	
	window.onload = function() {
		document.getElementById("Score").innerHTML = 0;
		document.getElementById("Lives").innerHTML = 3;
		let ip1 = randomIP();
		let ip2 = randomIP();
		let ip3 = randomIP();
		ipList.push(ip1);
		ipList.push(ip2);
		ipList.push(ip3);
		chooseIP(0);
		choosePorts();
	};
	
	function check(button) {
		var flagarray = []
		var score = document.getElementById("Score").innerHTML;
		flag1 = stage1check(button);
		if (score >= 10) {
			flag2 = stage2check(button)
			if (flag2 == false) {
				document.getElementById("Lives").innerHTML --;
			}
			else if (flag2 == true && flag1 == false) {
				document.getElementById("Lives").innerHTML --;
			}
			else {
				document.getElementById("Score").innerHTML ++;
			}
		}
		else {
			if (flag1 == false) {
				document.getElementById("Lives").innerHTML --;
			}
			else {
				document.getElementById("Score").innerHTML ++;
			}
		}
		chooseIP(score);
		choosePorts();
	}
	
	function stage1check(button) {
		var ourIP = document.getElementById("YourIP").innerHTML;
		var destination = document.getElementById("DestinationIP").innerHTML;
		if (ourIP == destination && button == 'allow') {
			document.getElementById("Message").innerHTML = "God job, that packet was for us";
			return true;
		}
		else if (ourIP != destination && button == 'deny') {
			document.getElementById("Message").innerHTML = "Good job, that packet was not for us";
			return true;
		}
		else if (ourIP != destination && button == 'allow') {
			document.getElementById("Message").innerHTML = "Wrong, that packet was not for us";
			return false;
		}
		else {
			document.getElementById("Message").innerHTML = "Wrong, that packet was for us";
			return false;
		}
	}
	
	function stage2check(button) {
		var source = document.getElementById('SourceIP').innerHTML;
		var allow = document.getElementById("AllowFrom").innerHTML;
		if (source == allow && button == 'allow') {
			document.getElementById("Message").innerHTML = "God job, that packet is from a valid source";
			return true;
		}
		else if (source != allow && button == 'deny') {
			document.getElementById("Message").innerHTML = "Good job, that packet was not from a valid source";
			return true;
		}
		else if (source != allow && button == 'allow') {
			document.getElementById("Message").innerHTML = "Wrong, that packet was not from a valid source";
			return false;
		}
		else {
			document.getElementById("Message").innerHTML = "Wrong, that packet was from a valid source";
			return false;
		}
	}
</script>

</html>